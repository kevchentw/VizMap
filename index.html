<!DOCTYPE html>
<html>

<head>
	<title>Map Playground</title>
	<meta charset="utf-8" />

	<meta name="viewport" content="width=device-width, initial-scale=1.0">

	<link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.7.5/leaflet.css" />
</head>

<body>
	<div id="map" style="width: 1000px; height: 500px"></div>

	<script src="http://cdn.leafletjs.com/leaflet-0.7.5/leaflet.js"></script>
	<script>
		productTypes = ['food',
			'cloth',
			'living',
			'transport',
			'education',
			'leisure'
		];
		colors = ['#0092C7',
			'#9FE0F6',
			'#F3E59A',
			'#F3B59B',
			'#F29C9C',
			'#7BA3A8',
			'#F4F3DE',
			'#BEAD92',
			'#F35A4A'
		];

		circles = [];
		var map = L.map('map').setView([25.046074, 121.5494119], 15);

		L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=pk.eyJ1Ijoia2V2Y2hlbnR3IiwiYSI6ImNpZzRrNnJjajJ2bml1a201ZTgxYnByYXkifQ.6Aj4446JZbArro776O5y9A', {
			maxZoom: 20,
			attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, ' +
				'<a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, ' +
				'Imagery © <a href="http://mapbox.com">Mapbox</a>',
			id: 'mapbox.streets'
		}).addTo(map);

		function getRandomArbitrary(min, max) {
			return Math.random() * (max - min) + min;
		}

		function getRandomInt(min, max) {
			return Math.floor(Math.random() * (max - min)) + min;
		}

		function circleAnimation(circleID) {
			// console.log(circleID);
			var circle = circles[circleID];
			if (circle.getRadius() > 1) {
				circle.setRadius(circle.getRadius() - 0.2);
			} else {
				map.removeLayer(circle);
				circles.splice(circleID, 1);
			}
		}

		function createCircle(latlng, color, data) {
			var c = L.circle(latlng, 80, {
				'color': color,
				'fillOpacity': 1,
			}).addTo(map);
			c.bindPopup(data);
			circles.push(c);
			return c;
			// return (circles.length)-1;
		}

		function getRamdomPoint() {
			var bound = map.getBounds();
			var up = bound['_northEast']['lat'];
			var right = bound['_northEast']['lng'];
			var down = bound['_southWest']['lat'];
			var left = bound['_southWest']['lng'];
			var lng = getRandomArbitrary(left, right);
			var lat = getRandomArbitrary(down, up);
			var latlng = L.latLng(lat, lng);
			return latlng;
		}

		function fakeLivePayment() {
			var type = getRandomInt(0, productTypes.length);
			var data = "類別:" + productTypes[type] + "\n" + "金額:" + getRandomInt(100,5000) + "\n" + "帳號:" + getRandomInt(1000000,2000000);
			var c = createCircle(getRamdomPoint(), colors[type], data);
			// console.log(c);
			// setInterval('circleAnimation(c)', 100);
		}

		function fakeLivePaymentAnimate() {
			for (var i = 0; i < circles.length; i++) {
				circleAnimation(i);
			}
		}
		setInterval("fakeLivePayment()", 100);
		setInterval("fakeLivePaymentAnimate()", 10);
	</script>
</body>

</html>
